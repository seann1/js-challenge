From dee53b7062c41135bb2282d9b73691724ca61ccb Mon Sep 17 00:00:00 2001
From: Sean Niesen <seanniesen@gmail.com>
Date: Mon, 2 Mar 2015 16:32:09 -0800
Subject: [PATCH 16/25] current timezone option is now accurate

---
 app.js     | 25 +++++++++++++++----------
 index.html |  2 +-
 2 files changed, 16 insertions(+), 11 deletions(-)

diff --git a/app.js b/app.js
index 2273d7a..631bb06 100644
--- a/app.js
+++ b/app.js
@@ -11,7 +11,7 @@ app.controller('MainCtrl', [
 			var startDateMilli = new Date($scope.startDate).getTime();
 			var endDateMilli = new Date($scope.endDate).getTime();
 			var dates = [];
-			console.log($scope.timeZone);
+			console.log($scope.zone);
 
 
 
@@ -26,6 +26,7 @@ app.controller('MainCtrl', [
 
 	   				var currentDate = new Date(startDateMilli);
 	   				var splitDate = moment(currentDate).format("M-D-YYYY");
+	   				var dashDate = moment(currentDate).format("M/D/YYYY");
 	   				var splitDashDate = moment(currentDate).format('YYYY-MM-DD');
 	   				dates.push(splitDate);
 	   				var latitude = results[0].geometry.location.lat();
@@ -35,16 +36,20 @@ app.controller('MainCtrl', [
 											    		url: sunriseurl,
 											    		dataType: "JSONP",
 											    		success: function(data) {
+												    			function toTimeZone(time) {
+												    				if ($scope.zone.toString() === "current") {
+												    					var date = new Date(dashDate + " " + time + " UTC");
+												    					return moment(date).format("h:mm:ss a");
+												    				} else {
+												    					var timezone = $scope.zone;
+													    				var sunrise = moment.tz(splitDashDate + " " + time, "UTC");
+													    				sunrise = sunrise.tz(timezone).format("h:mm:ss a");
+													    				return sunrise;
+												    				}
+												    			}
 
-											    			function toTimeZone(time) {
-											    				var sunrise = moment.tz(splitDashDate + " " + time, "UTC");
-											    				sunrise = sunrise.tz("America/Los_Angeles").format("h:mm:ss a");
-											    				return sunrise;
-											    			}
-
-											    			$("#sunrises").append("<tr class='day day" + i + "'><td class='date date" + i + "'>" + "</td><td>" + toTimeZone(data.results.sunrise) + "</td><td>" + toTimeZone(data.results.sunset) + "</td><td>" + data.results.day_length + "</td><td><button class='btn btn-default' data-toggle='modal' data-target='#modal" + i + "'>More Info</button></td></tr>");
-											    			$(".modals").append('<div class="modal fade" id="modal' + i + '"tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title">' + splitDate + '</h4></div><div class="modal-body">' + '<div class="modal-details">Astronomical twilight Begins: ' + toTimeZone(data.results.astronomical_twilight_begin) + '</div>' + '<div class="modal-details">Astronomical Twilight Ends: ' + toTimeZone(data.results.astronomical_twilight_end) + '</div><div class="modal-details">Civil Twilight Begins: ' + toTimeZone(data.results.civil_twilight_begin) + '</div><div class="modal-details">Civil Twilight Ends: ' + toTimeZone(data.results.civil_twilight_end) + '</div>' + '<div class="modal-details">Nautical Twilight Begins: ' + toTimeZone(data.results.nautical_twilight_begin) + '</div><div class="modal-details">Nautical Twilight Ends: ' + toTimeZone(data.results.nautical_twilight_end) + '</div><div class="modal-details">Solar Noon: ' + toTimeZone(data.results.solar_noon) + '</div><div class="modal-footer"></div></div></div></div>');
-
+												    			$("#sunrises").append("<tr class='day day" + i + "'><td class='date date" + i + "'>" + "</td><td>" + toTimeZone(data.results.sunrise) + "</td><td>" + toTimeZone(data.results.sunset) + "</td><td>" + data.results.day_length + "</td><td><button class='btn btn-default' data-toggle='modal' data-target='#modal" + i + "'>More Info</button></td></tr>");
+											    				$(".modals").append('<div class="modal fade" id="modal' + i + '"tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title">' + splitDate + '</h4></div><div class="modal-body">' + '<div class="modal-details">Astronomical twilight Begins: ' + toTimeZone(data.results.astronomical_twilight_begin) + '</div>' + '<div class="modal-details">Astronomical Twilight Ends: ' + toTimeZone(data.results.astronomical_twilight_end) + '</div><div class="modal-details">Civil Twilight Begins: ' + toTimeZone(data.results.civil_twilight_begin) + '</div><div class="modal-details">Civil Twilight Ends: ' + toTimeZone(data.results.civil_twilight_end) + '</div>' + '<div class="modal-details">Nautical Twilight Begins: ' + toTimeZone(data.results.nautical_twilight_begin) + '</div><div class="modal-details">Nautical Twilight Ends: ' + toTimeZone(data.results.nautical_twilight_end) + '</div><div class="modal-details">Solar Noon: ' + toTimeZone(data.results.solar_noon) + '</div><div class="modal-footer"></div></div></div></div>');
 										    			  i += 1;
 											    			return data;
 											    		}
diff --git a/index.html b/index.html
index faf42d5..0dfa300 100644
--- a/index.html
+++ b/index.html
@@ -34,7 +34,7 @@
         <label>End Date</label>
         <input type="date" ng-model="endDate"></input>
         <label>Time Zone</label>
-        <select ng-model="timeZone">
+        <select ng-model="zone" id="zone">
           <option value="current">My Current Timezone</option>
           <option value="US/Pacific">US Pacific</option>
           <option value="US/Eastern">US Eastern</option>
-- 
2.1.3.36.g8e36a6d

